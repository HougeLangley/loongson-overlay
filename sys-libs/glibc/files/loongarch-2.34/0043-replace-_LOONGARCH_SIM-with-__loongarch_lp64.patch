From 7f16fd6a471ffe7d80cf5c17210edc79514598c7 Mon Sep 17 00:00:00 2001
From: caiyinyu <caiyinyu@loongson.cn>
Date: Fri, 26 Nov 2021 17:59:32 +0800
Subject: [PATCH 43/46] replace _LOONGARCH_SIM with __loongarch_lp64

---
 sysdeps/loongarch/dl-trampoline.S               | 6 +++---
 sysdeps/loongarch/nptl/bits/pthreadtypes-arch.h | 2 +-
 sysdeps/loongarch/start.S                       | 2 +-
 sysdeps/loongarch/sys/asm.h                     | 2 +-
 sysdeps/loongarch/sys/regdef.h                  | 2 +-
 sysdeps/unix/sysv/linux/loongarch/clone.S       | 2 +-
 sysdeps/unix/sysv/linux/loongarch/clone3.S      | 2 +-
 7 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/sysdeps/loongarch/dl-trampoline.S b/sysdeps/loongarch/dl-trampoline.S
index 68355f4fde..dcc8f50429 100644
--- a/sysdeps/loongarch/dl-trampoline.S
+++ b/sysdeps/loongarch/dl-trampoline.S
@@ -31,7 +31,7 @@
 ENTRY (_dl_runtime_resolve)
 
 	/* Save arguments to stack. */
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 	addi.d	sp, sp, -FRAME_SIZE
 #else
 #error "32bit LoongArch systems are not supported"
@@ -59,7 +59,7 @@ ENTRY (_dl_runtime_resolve)
 #endif
 
 	/* Update .got.plt and obtain runtime address of callee */
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 	slli.d	a1, t1, 1
 	or	a0, t0, zero
 	add.d	a1, a1, t1
@@ -92,7 +92,7 @@ ENTRY (_dl_runtime_resolve)
 	FREG_L	fa7, sp, 10*SZREG + 7*SZFREG
 #endif
 
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 	addi.d	sp, sp, FRAME_SIZE
 #else
 #error "32bit LoongArch systems are not supported"
diff --git a/sysdeps/loongarch/nptl/bits/pthreadtypes-arch.h b/sysdeps/loongarch/nptl/bits/pthreadtypes-arch.h
index 221526d5fd..d697fff735 100644
--- a/sysdeps/loongarch/nptl/bits/pthreadtypes-arch.h
+++ b/sysdeps/loongarch/nptl/bits/pthreadtypes-arch.h
@@ -21,7 +21,7 @@
 
 #include <bits/endian.h>
 
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 #define __SIZEOF_PTHREAD_ATTR_T 56
 #define __SIZEOF_PTHREAD_MUTEX_T 40
 #define __SIZEOF_PTHREAD_MUTEXATTR_T 4
diff --git a/sysdeps/loongarch/start.S b/sysdeps/loongarch/start.S
index 8854468a38..afe190739d 100644
--- a/sysdeps/loongarch/start.S
+++ b/sysdeps/loongarch/start.S
@@ -48,7 +48,7 @@ ENTRY (ENTRY_POINT)
 /* We must get symbol main through GOT table, since main may not be local.
    For instance: googletest defines main in dynamic library.  */
 	la.got		a0, t0, main
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 	ld.d		a1, sp, 0
 	addi.d		a2, sp, SZREG
 #else
diff --git a/sysdeps/loongarch/sys/asm.h b/sysdeps/loongarch/sys/asm.h
index cdcd0c187c..678829437d 100644
--- a/sysdeps/loongarch/sys/asm.h
+++ b/sysdeps/loongarch/sys/asm.h
@@ -24,7 +24,7 @@
 #include <sysdeps/generic/sysdep.h>
 
 /* Macros to handle different pointer/register sizes for 32/64-bit code.  */
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 #define PTRLOG 3
 #define SZREG 8
 #define SZFREG 8
diff --git a/sysdeps/loongarch/sys/regdef.h b/sysdeps/loongarch/sys/regdef.h
index e367505f9a..d7889adbf1 100644
--- a/sysdeps/loongarch/sys/regdef.h
+++ b/sysdeps/loongarch/sys/regdef.h
@@ -20,7 +20,7 @@
 #ifndef _SYS_REGDEF_H
 #define _SYS_REGDEF_H
 
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 #define zero $r0
 #define ra $r1
 #define tp $r2
diff --git a/sysdeps/unix/sysv/linux/loongarch/clone.S b/sysdeps/unix/sysv/linux/loongarch/clone.S
index b147529738..2fd1a0d5dc 100644
--- a/sysdeps/unix/sysv/linux/loongarch/clone.S
+++ b/sysdeps/unix/sysv/linux/loongarch/clone.S
@@ -32,7 +32,7 @@
 ENTRY (__clone)
 
 	/* Align stack to 16 or 8 bytes per the ABI.  */
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 	bstrins.d	a1, zero, 3, 0
 #else
 #error "32bit LoongArch systems are not supported"
diff --git a/sysdeps/unix/sysv/linux/loongarch/clone3.S b/sysdeps/unix/sysv/linux/loongarch/clone3.S
index 12ff3055e1..fa1abd2779 100644
--- a/sysdeps/unix/sysv/linux/loongarch/clone3.S
+++ b/sysdeps/unix/sysv/linux/loongarch/clone3.S
@@ -66,7 +66,7 @@ L (thread_start3):
 	cfi_undefined (1)
 
 	/* Align stack to 16 or 8 bytes per the ABI.  */
-#if _LOONGARCH_SIM == _ABILP64
+#ifdef __loongarch_lp64
 	bstrins.d	sp, zero, 3, 0
 #else
 #error "32bit LoongArch systems are not supported"
-- 
2.34.0

